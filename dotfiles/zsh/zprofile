#
# Executes commands at login pre-zshrc.
#
# Authors:
#   Sorin Ionescu <sorin.ionescu@gmail.com>
#

makelink () {
    DN=$1
    if readlink ~/$DN >/dev/null; then
        mkdir -p $(readlink ~/$DN)
    else
        D=/tmp/${USER}
        if [ -d $D/$DN ]; then
            echo "Deleting ~/$DN"
            rm -ri ~/$DN && ln -fs $D/$DN ~/$DN
        else
            echo "Deleting $D/$DN"
            rm -ri $D/$DN
            echo "Moving ~/$DN to $D/$DN"
            mkdir -p $D && mv ~/$DN $D/ && ln -fs $D/$DN ~/$DN
        fi
    fi
}

makelink .cache
makelink Downloads

(cd $HOME
for nm in .mozilla/firefox/*/Cache; do
    if readlink $nm >/dev/null; then
        echo Ok
    else
        mkdir -p .cache/mozilla/firefox
        LN=$HOME/.cache/mozilla/firefox/$(dirname $nm)
        echo "Moving $nm to $LN"
        mv -i $nm $LN
        rm -ri $nm
        ln -fs $LN $nm
    fi
done)

