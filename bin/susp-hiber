#!/bin/sh
logger $(basename $0) "$@"
[ -x $(dirname $0)/remote-xlock ] && (
  remote-xlock &
  sleep 1
)
case "$1" in
hibernate|Hibernate) CMD_initcap=Hibernate; CMD_lower=hibernate
    ;;
*) CMD_initcap=Suspend; CMD_lower=suspend
    ;;
esac

Z=1
if [ -n "$(pidof gnome-power-manager >/dev/null)" \
    -o -n "$(pidof xfce4-power-manager >/dev/null)" ]; then
  dbus-send --session --dest=org.freedesktop.PowerManagement \
    --type=method_call --print-reply --reply-timeout=1 \
    /org/freedesktop/PowerManagement \
    org.freedesktop.PowerManagement.${CMD_initcap}
  Z=$?
  logger 'dbus-send --dest=org.freedesktop.PowerManagement: '$Z
fi
[ $Z -ne 0 ] && {
    logger 'calling pm-'${CMD_lower}
    sudo pm-${CMD_lower}
}
