#!/bin/sh
#xfreerdp -k 0x409 -x m -a 16 -z -g 1900x1080 -d unosoft -u tgulacsi --ignore-certificate --sec tls unots2
#xfreerdp /size:$(getscreensize) /cert-ignore /sec:tls /drive:tmp,/tmp +clipboard /u:tgulacsi /d:unosoft /smartcard,Gemalto /v:unots2
#xfreerdp -g workarea --ignore-certificate --sec tls --plugin rdpdr --data scard disk:tmp:/tmp -- --plugin cliprdr unots2
#!/bin/sh
if [ -z $direct ]; then
    direct=0
case $(uname -n) in
    nell|tgulacsi-desktop)
        if /sbin/ifconfig | grep -q 'inet addr:10.65.25.'; then # unosoft
            direct=1
        fi
esac
fi

SIZE=${SIZE:-$(getscreensize 2 16)}
echo SIZE=$SIZE
OPTS="$OPTS +clipboard /kbd:0x409 -wallpaper -themes /fonts /gdi:hw /drive:tmp,/tmp /size:$SIZE"
if lsusb | grep -q Gemplus; then
    OPTS="$OPTS /a:smartcard,Gemplus"
fi

dest=${1:-unots2}
prog=${RDP:-xfreerdp}

pkill -f "${prog}.*/v:${dest}"

echo "direct=$direct"
if [ $direct -gt 0 ]; then
	#exec /usr/local/src/tgulacsi/FreeRDP/MK/client/X11/xfreerdp \
	exec ${prog} /u:UNOSOFT\\TGulacsi /cert-ignore /sec:tls $OPTS /v:${dest}
##/usr/bin/rdesktop -P -k en -e \
#${RDP:-xfreerdp} -k 0x409 --plugin cliprdr -x m -a 16 -z \
#  -g $SIZE --gdi hw -d unosoft -u tgulacsi \
#  --sec tls \
#  ${1:-unots}
#  # scard --plugin cliprdr \
#  #--plugin rdpdr disk:tmp:/tmp -- \
else
	CMD="${prog} $OPTS \
		/v:${dest} \
		/u:tgulacsi /d:unosoft \
		/g:mail.unosoft.hu /gu:tgulacsi /gd:unosoft \
		/gp:$(cat ~/.ssh/rdpgw.pwd) \
		/sec:rdp"
    #exec $(dirname $0)/uno "${1:-unots}"; break
    echo $CMD
    exec $CMD
fi
#ssh -o ControlPersist=no -L 3389:unots:3389 -o Port=2222 portforward@mail.unosoft.hu -N
